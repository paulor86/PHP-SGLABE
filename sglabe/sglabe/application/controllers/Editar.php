<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Editar extends CI_Controller {
	//instancia a classe principal 

	public function __construct(){
		parent::__construct();
		$this->load->helper('url');
		$this->load->helper('functions');
		$this->load->library('form_validation');
		$this->load->database();
		$this->load->library('session');
		$this->load->model('Acesso_model','Banco');

		if(!$this->Banco->getDataSession('matricula') || $this->Banco->checkSession('perfil','usuario')){
			$this->session->sess_destroy();
			redirect(base_url(),'location');
		}

	}

	//Editar uma maquina
	public function maquina(){
		$page['pageTitle'] = "Editar Computador";
		$this->load->model('Laboratorios_model','Labs');
		$this->load->model('Maquinas_model','Maquinas');
		$page['getLab'] = $this->Labs->getCodLabs($this->Banco->getDataSession('area')); 
		$page['tmpTombo'] = $this->uri->segment(3);
		$page['dadosMaquina'] = $this->Maquinas->checkMaquina($page['tmpTombo']);
		
		if($page['dadosMaquina']) {
			$page['cod_lab'] = $this->input->post() ? $this->input->post('cod_lab') : $page['dadosMaquina']->fk_codigo_lab;
			$page['descricao'] = $this->input->post() ? $this->input->post('descricao_maquina') : $page['dadosMaquina']->descricao;
			$page['tombo'] = $this->input->post() ? $this->input->post('tombo_maquina') : $page['dadosMaquina']->tombo;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     

			if($this->input->post()){
				$this->form_validation->set_rules('tombo_maquina', 'Tombo da máquina', 'required|max_length[30]|trim');
				$this->form_validation->set_rules('descricao_maquina', 'Descrição da máquina', 'required|max_length[255]|trim');
				$this->form_validation->set_rules('cod_lab', 'Laboratório', 'required|numeric|trim');
				if($this->form_validation->run() == FALSE){
							$page['alertas'] = msgError(validation_errors());
							$this->load->view('editar/maquina',$page);
	            }else{
		            if($this->Labs->atualizaMaquina($page['tmpTombo'])){
		            	$page['alertas'] = msgSucesso("<b>Sucesso!</b> os dados do computador foram atualizados");
		            	$page['dataMaquinas'] = $this->Labs->listaMaquinas();
						$this->load->view('ver/maquina',$page);
		            }else{
		            	$page['alertas'] = msgError("<b>Erro!</b> Verifique os dados digitados e tente novamente");
		            	$this->load->view('editar/maquina',$page);
		            }
	            }
			}else{
				$this->load->view('editar/maquina',$page);
			}
			
		} else{
			$page['alertas'] = msgError("<b>Erro!</b> Máquina não encontrada");
			$page['dataMaquinas'] = $this->Labs->listaMaquinas();
			$this->load->view('ver/maquina',$page);
		}
		
	}

		//Editar um horário
	public function horario(){
		$page['pageTitle'] = "Editar horário";
		$this->load->model('Horarios_model','Horarios');
		$page['tmpTurno'] = $this->uri->segment(3);
		$page['tmpTempo'] = $this->uri->segment(4);
		$page['dadosHorario'] = $this->Horarios->checkHorario($page['tmpTempo'],$page['tmpTurno']);
		
		if($page['dadosHorario']) {

			if(!$this->input->post()){
			$Inicio = explode(":",$page['dadosHorario']->inicio);
			$Fim = explode(":",$page['dadosHorario']->fim);
			$inicioHora = $Inicio[0];
            $inicioMin = $Inicio[1];
            $inicioSeg = $Inicio[2];
            $fimHora = $Fim[0];
            $fimMin = $Fim[1];
            $fimSeg = $Fim[2];
			}

			$page['tempo'] = $this->input->post() ? $this->input->post('tempo') : $page['dadosHorario']->tempo;
			$page['turno'] = $this->input->post() ? $this->input->post('turno') : $page['dadosHorario']->turno;
			$page['inicio_hora'] = $this->input->post() ? $this->input->post('inicio_hora') : $inicioHora;
			$page['inicio_minuto'] = $this->input->post() ? $this->input->post('inicio_minuto') : $inicioMin;
			$page['inicio_segundo'] = $this->input->post() ? $this->input->post('inicio_segundo') : $inicioSeg;
			$page['fim_hora'] = $this->input->post() ? $this->input->post('fim_hora') : $fimHora;
			$page['fim_minuto'] = $this->input->post() ? $this->input->post('fim_minuto') : $fimMin;
			$page['fim_segundo'] = $this->input->post() ? $this->input->post('fim_segundo') : $fimSeg;

		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           

			if($this->input->post()){
				$this->form_validation->set_rules('tempo', 'Cadastrar Horário','required|numeric|max_length[1]|trim');
				$this->form_validation->set_rules('turno', 'Cadastrar Turno', 'required|numeric|max_length[1]|trim');
				$this->form_validation->set_rules('inicio_hora', 'Hora do início', 'required|max_length[2]|trim');
				$this->form_validation->set_rules('inicio_minuto', 'Minuto do horario de início', 'required|max_length[2]|trim');
				$this->form_validation->set_rules('inicio_segundo', 'Segundo do horario de início', 'required|max_length[2]|trim');
				$this->form_validation->set_rules('fim_hora', 'Hora do fim', 'required|max_length[2]|trim');
				$this->form_validation->set_rules('fim_minuto', 'Minuto do horario de fim', 'required|max_length[2]|trim');
				$this->form_validation->set_rules('fim_segundo', 'Segundo do horario de fim', 'required|max_length[2]|trim');
				if($this->form_validation->run() == FALSE){
							$page['alertas'] = msgError(validation_errors());
							$this->load->view('editar/horario',$page);
	            }else{
		            if($this->Horarios->atualizaHorario($page['tmpTurno'],$page['tmpTempo'])){
		            	$page['alertas'] = msgSucesso("<b>Sucesso!</b> os dados do horário foram atualizados");
		            	$page['dataHorario'] = $this->Horarios->listarHorario();
						$this->load->view('ver/horario',$page);
		            }else{
		            	$page['alertas'] = msgError("<b>Erro!</b> Verifique os dados digitados e tente novamente");
		            	$this->load->view('editar/horario',$page);
		            }
	            }
			}else{
				$this->load->view('editar/horario',$page);
			}
			
		} else{
			$page['alertas'] = msgError("<b>Erro!</b> Horário não encontrado");
			$page['dataHorario'] = $this->Horarios->listarHorario();
			$this->load->view('ver/horario',$page);
		}
		
	}

	//Edita uma turma

	public function turma(){
		$page['pageTitle'] = "Editar Turma";
		$this->load->model('Turmas_model','Turmas');
		$this->load->model('Cursos_model','Cursos');
		$page['tmpCodTurma'] = $this->uri->segment(3);
		$page['dataCursos'] = $this->Cursos->listarCursos();
		$page['dadosTurma'] = $this->Turmas->checkTurma($page['tmpCodTurma']);
		
		if($page['dadosTurma']) {
			$page['codigo_turma'] = $this->input->post() ? $this->input->post('codigo_turma') : $page['dadosTurma']->codigo_turma;
			$page['fk_codigo_curso'] = $this->input->post() ? $this->input->post('fk_codigo_curso') : $page['dadosTurma']->fk_codigo_curso;
			$page['periodo'] = $this->input->post() ? $this->input->post('periodo') : $page['dadosTurma']->periodo;
			$page['turno'] = $this->input->post() ? $this->input->post('turno') : $page['dadosTurma']->turno;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     

			if($this->input->post()){
				$this->form_validation->set_rules('codigo_turma', 'Código da turma', 'required|max_length[8]|trim');
				$this->form_validation->set_rules('fk_codigo_curso', 'Curso', 'required|max_length[8]|trim');
				$this->form_validation->set_rules('periodo', 'Período', 'required|numeric|max_length[2]|trim');
				$this->form_validation->set_rules('turno', 'Turno', 'required|max_length[1]|trim');
				if($this->form_validation->run() == FALSE){
							$page['alertas'] = msgError(validation_errors());
							$this->load->view('editar/turma',$page);
	            }else{
		            if($this->Turmas->atualizaTurma($page['tmpCodTurma'])){
		            	$page['alertas'] = msgSucesso("<b>Sucesso!</b> os dados do curso foram atualizados");
		            	$page['dataTurma'] = $this->Turmas->listarTurma();
						$this->load->view('ver/turma',$page);
		            }else{
		            	$page['alertas'] = msgError("<b>Erro!</b> Verifique os dados digitados e tente novamente");
		            	$this->load->view('editar/turma',$page);
		            }
	            }
			}else{
				$this->load->view('editar/turma',$page);
			}
			
		} else{
			$page['alertas'] = msgError("<b>Erro!</b> Curso não encontrado");
			$page['dataTurma'] = $this->Turmas->listarTurma();
			$this->load->view('ver/turma',$page);
		}
		
	}


//Edita uma Disciplina

	public function disciplina(){
		$page['pageTitle'] = "Editar Disciplina";
		$this->load->model('Disciplinas_model','Disciplina');
		$page['tmpCodDisciplina'] = $this->uri->segment(3);
		$page['dadosDisciplina'] = $this->Disciplina->checkDisciplina($page['tmpCodDisciplina']);
		
		if($page['dadosDisciplina']) {
			$page['descricao_disciplina'] = $this->input->post() ? $this->input->post('descricao_disciplina') : $page['dadosDisciplina']->descricao;
			$page['codigo_disciplina'] = $this->input->post() ? $this->input->post('codigo_disciplina') : $page['dadosDisciplina']->codigo_disciplina;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     

			if($this->input->post()){
				$this->form_validation->set_rules('descricao_disciplina', 'Descrição da disciplina', 'required|max_length[40]|trim');
				$this->form_validation->set_rules('codigo_disciplina', 'Código da disciplina', 'required|max_length[8]|trim');
				if($this->form_validation->run() == FALSE){
							$page['alertas'] = msgError(validation_errors());
							$this->load->view('editar/disciplina',$page);
	            }else{
		            if($this->Disciplina->atualizaDisciplina($page['tmpCodDisciplina'])){
		            	$page['alertas'] = msgSucesso("<b>Sucesso!</b> os dados da disciplina foram atualizados");
		            	$page['dataDisciplina'] = $this->Disciplina->listarDisciplina();
						$this->load->view('ver/disciplina',$page);
		            }else{
		            	$page['alertas'] = msgError("<b>Erro!</b> Verifique os dados digitados e tente novamente");
		            	$this->load->view('editar/disciplina',$page);
		            }
	            }
			}else{
				$this->load->view('editar/disciplina',$page);
			}
			
		} else{
			$page['alertas'] = msgError("<b>Erro!</b> Disciplina não encontrada");
			$page['dataDisciplina'] = $this->Disciplina->listarDisciplina();
			$this->load->view('ver/disciplina',$page);
		}
		
	}
	//Edita um curso
	public function curso(){
		$page['pageTitle'] = "Editar Curso";
		$this->load->model('Cursos_model','Cursos');
		$page['tmpCodCurso'] = $this->uri->segment(3);
		$page['dadosCurso'] = $this->Cursos->checkCurso($page['tmpCodCurso']);
		
		if($page['dadosCurso']) {
			$page['codigo_curso'] = $this->input->post() ? $this->input->post('codigo_curso') : $page['dadosCurso']->codigo_curso;
			$page['nome_curso'] = $this->input->post() ? $this->input->post('nome_curso') : $page['dadosCurso']->descricao;
		
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     

			if($this->input->post()){
				$this->form_validation->set_rules('codigo_curso', 'Código do curso', 'required|max_length[30]|trim');
				$this->form_validation->set_rules('nome_curso', 'Nome do curso', 'required|max_length[255]|trim');
				if($this->form_validation->run() == FALSE){
							$page['alertas'] = msgError(validation_errors());
							$this->load->view('editar/curso',$page);
	            }else{
		            if($this->Cursos->atualizaCurso($page['tmpCodCurso'])){
		            	$page['alertas'] = msgSucesso("<b>Sucesso!</b> os dados do curso foram atualizados");
		            	$page['dataCurso'] = $this->Cursos->listarCursos();
						$this->load->view('ver/curso',$page);
		            }else{
		            	$page['alertas'] = msgError("<b>Erro!</b> Verifique os dados digitados e tente novamente");
		            	$this->load->view('editar/curso',$page);
		            }
	            }
			}else{
				$this->load->view('editar/curso',$page);
			}
			
		} else{
			$page['alertas'] = msgError("<b>Erro!</b> Curso não encontrado");
			$page['dataCurso'] = $this->Cursos->listaCursos();
			$this->load->view('ver/curso',$page);
		}
		
	}

	//Editar um equipamento
	public function equipamento(){
		$page['pageTitle'] = "Editar Equipamento";
		$this->load->model('Equipamentos_model','Equipamento');
		$page['tmpTombo'] = $this->uri->segment(3);
		$page['dadosEquipamento'] = $this->Equipamento->checkEquipamento($page['tmpTombo']);
		
		if($page['dadosEquipamento']) {
			$page['descricao'] = $this->input->post() ? $this->input->post('descricao_equipamento') : $page['dadosEquipamento']->descricao;
			$page['tombo'] = $this->input->post() ? $this->input->post('tombo_equipamento') : $page['dadosEquipamento']->tombo;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     

			if($this->input->post()){
				$this->form_validation->set_rules('tombo_equipamento', 'Tombo do Equipamento', 'required|max_length[30]|trim');
				$this->form_validation->set_rules('descricao_equipamento', 'Descrição do equipamento', 'required|max_length[255]|trim');
				if($this->form_validation->run() == FALSE){
							$page['alertas'] = msgError(validation_errors());
							$this->load->view('editar/equipamento',$page);
	            }else{
		            if($this->Equipamento->atualizaEquipamento($page['tmpTombo'])){
		            	$page['alertas'] = msgSucesso("<b>Sucesso!</b> os dados do equipamento foram atualizados");
		            	$page['dataEquipamentos'] = $this->Equipamento->listarEquipamentos();
						$this->load->view('ver/equipamento',$page);
		            }else{
		            	$page['alertas'] = msgError("<b>Erro!</b> Verifique os dados digitados e tente novamente");
		            	$this->load->view('editar/equipamento',$page);
		            }
	            }
			}else{
				$this->load->view('editar/equipamento',$page);
			}
			
		} else{
			$page['alertas'] = msgError("<b>Erro!</b> Equipamento não encontrado");
			$page['dataEquipamentos'] = $this->Equipamento->listarEquipamentos();
			$this->load->view('ver/equipamento',$page);
		}
		
	}


	//Edita um aluno
	public function usuario_aluno(){
		$page['pageTitle'] = "Editar dados do Aluno";
		$this->load->model('Usuarios_model','Usuarios');
		$page['tmpCodUsuario'] = $this->uri->segment(3);
		$page['dadosUsuario'] = $this->Usuarios->checkUsuarioAluno($page['tmpCodUsuario']);
		
		if($page['dadosUsuario']) {
			$page['nome'] = $this->input->post() ? $this->input->post('nome') : $page['dadosUsuario']->nome;
			$page['sobrenome'] = $this->input->post() ? $this->input->post('sobrenome') : $page['dadosUsuario']->sobrenome;
			$page['matricula'] = $this->input->post() ? $this->input->post('matricula') : $page['dadosUsuario']->matricula;
			$page['cpf'] = $this->input->post() ? $this->input->post('cpf') : $page['dadosUsuario']->cpf;
			$page['email'] = $this->input->post() ? $this->input->post('email') : $page['dadosUsuario']->email;
			$page['telefone'] = $this->input->post() ? $this->input->post('telefone') : $page['dadosUsuario']->telefone;


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
			if($this->input->post()){
				$this->form_validation->set_rules('nome', 'Nome', 'required|max_length[30]|trim');
				$this->form_validation->set_rules('sobrenome', 'Sobrenome', 'required|max_length[70]|trim');
				$this->form_validation->set_rules('matricula', 'Matrícula', 'required|numeric|max_length[8]|min_length[8]|trim');
				$this->form_validation->set_rules('cpf', 'CPF', 'required|max_length[14]|min_length[14]|trim');
				$this->form_validation->set_rules('email', 'E-mail', 'required|max_length[120]|trim');
				$this->form_validation->set_rules('telefone', 'Telefone', 'required|max_length[20]|trim');
				$this->form_validation->set_rules('senha', 'Senha', 'required|max_length[40]|trim');
				if($this->form_validation->run() == FALSE){
							$page['alertas'] = msgError(validation_errors());
							$this->load->view('editar/usuario_aluno',$page);
	            }else{
		            if($this->Usuarios->atualizaUsuarioAluno($page['tmpCodUsuario'])){
		            	$page['alertas'] = msgSucesso("<b>Sucesso!</b> os dados do Aluno foram atualizados");
		            	$page['dataAlunos'] = $this->Usuarios->listarUsuariosAlunos();
						$this->load->view('ver/usuario_aluno',$page);
		            }else{
		            	$page['alertas'] = msgError("<b>Erro!</b> Verifique os dados digitados e tente novamente");
		            	$this->load->view('editar/usuario_aluno',$page);
		            }
	            }
			}else{
				$this->load->view('editar/usuario_aluno',$page);
			}
			
		} else{
			$page['alertas'] = msgError("<b>Erro!</b> Aluno não encontrado");
			$page['dataAlunos'] = $this->Usuarios->listarUsuariosAlunos();
			$this->load->view('ver/usuario_aluno',$page);
		}
	}


	//Edita um professor
	public function usuario(){
		$page['pageTitle'] = "Editar dados do professor";
		$this->load->model('Usuarios_model','Usuarios');
		$page['tmpCodUsuario'] = $this->uri->segment(3);
		$page['dadosUsuario'] = $this->Usuarios->checkUsuarioProfessor($page['tmpCodUsuario'],$this->Banco->getDataSession('area'));
		
		if($page['dadosUsuario']) {
			$page['nome'] = $this->input->post() ? $this->input->post('nome') : $page['dadosUsuario']->nome;
			$page['sobrenome'] = $this->input->post() ? $this->input->post('sobrenome') : $page['dadosUsuario']->sobrenome;
			$page['matricula'] = $this->input->post() ? $this->input->post('matricula') : $page['dadosUsuario']->matricula;
			$page['cpf'] = $this->input->post() ? $this->input->post('cpf') : $page['dadosUsuario']->cpf;
			$page['email'] = $this->input->post() ? $this->input->post('email') : $page['dadosUsuario']->email;
			$page['telefone'] = $this->input->post() ? $this->input->post('telefone') : $page['dadosUsuario']->telefone;


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
			if($this->input->post()){
				$this->form_validation->set_rules('nome', 'Nome', 'required|max_length[30]|trim');
				$this->form_validation->set_rules('sobrenome', 'Sobrenome', 'required|max_length[70]|trim');
				$this->form_validation->set_rules('matricula', 'Matrícula', 'required|numeric|max_length[8]|min_length[8]|trim');
				$this->form_validation->set_rules('cpf', 'CPF', 'required|max_length[14]|min_length[14]|trim');
				$this->form_validation->set_rules('email', 'E-mail', 'required|max_length[120]|trim');
				$this->form_validation->set_rules('telefone', 'Telefone', 'required|max_length[20]|trim');
				$this->form_validation->set_rules('senha', 'Senha', 'required|max_length[40]|trim');
				$this->form_validation->set_rules('perfil', 'Perfil', 'required|max_length[20]|trim');

				if($this->form_validation->run() == FALSE){
							$page['alertas'] = msgError(validation_errors());
							$this->load->view('editar/usuario',$page);
	            }else{
		            if($this->Usuarios->atualizaUsuarioProfessor($page['tmpCodUsuario'],$this->Banco->getDataSession('area'))){
		            	$page['alertas'] = msgSucesso("<b>Sucesso!</b> os dados do Professor foram atualizados");
		            	$page['dataProfessor'] = $this->Usuarios->listarUsuariosProfessores($this->Banco->getDataSession('area'));
						$this->load->view('ver/usuario',$page);
		            }else{
		            	$page['alertas'] = msgError("<b>Erro!</b> Verifique os dados digitados e tente novamente");
		            	$this->load->view('editar/usuario',$page);
		            }
	            }
			}else{
				$this->load->view('editar/usuario',$page);
			}
			
		} else{
			$page['alertas'] = msgError("<b>Erro!</b> Professor não encontrado");
			$page['dataProfessor'] = $this->Usuarios->listarUsuariosProfessores($this->Banco->getDataSession('area'));
			$this->load->view('ver/usuario',$page);
		}
	}


	//Editar um laboratório
	public function laboratorio(){
		$page['pageTitle'] = "Editar Laboratório";
		$this->load->model('Laboratorios_model','Laboratorio');
		$page['tmpCodigoLaboratorio'] = $this->uri->segment(3);
		$page['dadosLaboratorio'] = $this->Laboratorio->checkLaboratorio($page['tmpCodigoLaboratorio']);
		
		if($page['dadosLaboratorio']) {
			$page['codigo_laboratorio'] = $this->input->post() ? $this->input->post('codigo_laboratorio') : $page['dadosLaboratorio']->codigo_lab;
			$page['descricao'] = $this->input->post() ? $this->input->post('descricao') : $page['dadosLaboratorio']->descricao;
			if($this->Banco->getDataSession('area') == 'informatica'){
				$page['n_maquina'] = $this->input->post() ? $this->input->post('n_maquina') : $page['dadosLaboratorio']->num_maquinas;
			}	
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           

			if($this->input->post()){
				$this->form_validation->set_rules('codigo_laboratorio', 'Código do Laboratório', 'required|numeric|trim');
				$this->form_validation->set_rules('descricao', 'Descrição', 'required|max_length[40]|trim');		
				if($this->Banco->getDataSession('area') == 'informatica'){
					$this->form_validation->set_rules('n_maquina', 'Número de Máquinas', 'required|numeric|trim');
				}	
				if($this->form_validation->run() == FALSE){
							$page['alertas'] = msgError(validation_errors());
	            }else{
	            	if($this->Laboratorio->checkLaboratorio($this->input->post('codigo_laboratorio')) && $page['tmpCodigoLaboratorio'] != $this->input->post('codigo_laboratorio')){
	            		$page['alertas'] = msgError("<b>Erro!</b> O laboratório informado já existe");
	            	}else{
	            		
	            		if($this->Laboratorio->atualizaLaboratorio($page['tmpCodigoLaboratorio'],$this->Banco->getDataSession('area'))){
		            		$page['alertas'] = msgSucesso("<b>Sucesso!</b> Os dados do laboratório foram atualizados");
		            		$page['dataLaboratorio'] = $this->Laboratorio->listarLaboratorio($this->Banco->getDataSession('area'));
		            	}else{
		            		$page['alertas'] = msgError("<b>Erro!</b> Verifique os dados digitados e tente novamente");
		            	}
	            	}
		            
	            }
			}
				$this->load->view('editar/laboratorio',$page);
			
			
		} else{
			$page['alertas'] = msgError("<b>Erro!</b> Laboratório não encontrado");
			$page['dataLaboratorio'] = $this->Laboratorio->listarLaboratorio($this->Banco->getDataSession('area'));
			$this->load->view('ver/laboratorio',$page);
		}
		
	}
}

?>